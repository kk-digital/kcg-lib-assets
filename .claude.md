# kcg-lib-assets Project Instructions

## Todo Tracking

- Maintain todo.txt at project root for cross-session task tracking
- Update todo.txt after completing tasks or when session ends
- Format: One task per line, plain text
- Mark completed tasks with [x] prefix
- Mark in-progress tasks with [>] prefix
- Mark pending tasks with [ ] prefix

## Project Purpose

Asset decompression libraries and benchmarks for KCG project.
Provides standardized image decompression with benchmarking.

## Layer Architecture (Lexicographic Prefixing)

Layers use lexicographic prefixes to enforce dependency rules:
- c0- : Core libraries (lowest layer, no dependencies on higher layers)
- c1- : Intermediate libraries (can depend on c0 only)
- c2- : Applications/runners (can depend on c0 and c1)

RULE: Lower layers CANNOT import higher layers (c0 cannot import c1/c2, c1 cannot import c2)

Folder naming: c0-[name], c1-[name], c2-[name]
Assembly naming: c0-[name], c1-[name], c2-[name]
Namespace prefix: c0_[name], c1_[name], c2_[name] (underscores for C# namespaces)

## Assembly Structure

### Layer 0 (Core Libraries)
- c0-timing/ - High-precision interval timing (nanosecond)
- c0-benchmark-result/ - Benchmark result structs and standard I/O types
- c0-decompression-png/ - PNG wrapper for StbImageSharp
- c0-decompression-jpg/ - JPG wrapper for StbImageSharp

### Layer 1 (Benchmark Runners)
- c1-benchmark-png-stbimage/ - PNG benchmark runner using StbImageSharp
- c1-benchmark-jpg-stbimage/ - JPG benchmark runner using StbImageSharp

### Layer 2 (Applications)
- c2-benchmark/ - CLI benchmark runner and reporter

### Data
- data/png/ - Test PNG files for decompression testing
- data/jpg/ - Test JPG files for decompression testing

## Architectural Requirements

### 1. FILE I/O SEPARATION
Libraries do NOT read from disk. Benchmark runner:
- Loads file bytes from disk
- Times file I/O separately
- Passes bytes to decompression library
- Library returns ImageOutput

### 2. STANDARD INPUT/OUTPUT
All libraries use these types (in c0-benchmark-result):
- FileInput: filename, path, size, byte[]
- ImageOutput: width, height, components, RGBA pixel data, success, error

### 3. BENCHMARK DATA COLLECTION
CRITICAL: Do NOT contaminate timing data!

PHASE 1 (Data Collection):
- Time file read from disk
- Time library decompression call
- Store raw tick values immediately
- NO sorting, NO statistics during this phase

PHASE 2 (Post-Processing):
- Array sorting, grouping by size category
- Statistics computation
- Summary aggregation
- Report generation

### 4. DEPENDENCY DIRECTION
- c0 libs have no internal dependencies (only NuGet)
- c1 runners depend on c0 only
- c2 apps can depend on any c0/c1 libs

### 5. SELF-CONTAINED
- Copy code rather than importing from other repos
- Exception: NuGet packages are allowed

## Report Requirements

Reports MUST include:
1. N of M format for counts (e.g., "696 of 696 successful")
2. Library name and version
3. Init time (library initialization)
4. Breakdown by image size (32, 64, 128, 256, 512, 1024, >1024)
5. For each size category:
   - File count
   - Library used
   - File read time
   - Decompression time
   - Bytes/second (input over decompression time)
   - Bytes/second (output over decompression time)
6. Total bytes in/out
7. Compression ratio

## Code Style

- C# with Go-like primitives and static functions
- Avoid OOP patterns, prefer simple structs with data
- Use // comments only (no XML doc comments)
- Comments for architecture notes are encouraged
